var menuOpen=false;var isMobile=Modernizr.mq("only screen and (max-width: 768px)");function resizeElements(){if($('.splash').length>0){var ww=$(window).width(),wh=$(window).height(),img=$('.splash').find('img'),iw=img.attr('width'),ih=img.attr('height'),ratio=iw/ih;if(ratio<ww/wh){img.css({'width':ww,'height':ww/ratio,'margin-left':-ww/2});}else{img.css({'width':wh*ratio,'height':wh,'margin-left':-(wh*ratio)/2});}
setTimeout(function(){img.fadeIn(400);},2000);setTimeout(function(){$('.splash').fadeOut(400)},5000);}
var timer=0;var $fadeEffects=$(".fadeEffect");$fadeEffects.each(function(){var $this=$(this);timer+=400;setTimeout(function(){$this.animate({opacity:0},0000);},timer);});var $current=$(".fancybox-inner");if($current.length>0){var ww=$(window).width();var left=(ww-$current.width())/2;var offsets=$current.find(".fancybox-image").offset();$(".previous-slide").css({"height":$current.height()-1,"right":(ww-offsets.left)});$(".next-slide").css({"height":$current.height()-1,"left":(ww-offsets.left)});}
$('.scrollup').css("bottom",$("footer").height());if($('.fluidContainer').length>0){var ww=$(window).width(),c=$('.fluidContainer'),pw=c.parents('.container').width(),columns=parseInt($('.fluidContainer').attr('data-params')),max=parseInt($('.fluidContainer').attr('data-max')),ratio=$('.fluidContainer').attr('data-ratio').split('/'),ratio=parseInt(ratio[0])/parseInt(ratio[1]),ncw=0,nw=0,nh=0;c.animate({'opacity':1},800);}
if($('#teamMemberBlocks').length>0){var ww=$(window).width(),parent=$('#teamMemberBlocks'),currW=$('.container').width()-20,maxW=1260,maxH=520,ratio=maxW/maxH,col1=300,col2=400,col3=340,col4=220,x=null;parent.height(currW/ratio);parent.find('.col1').css({'width':currW*(col1/maxW)});parent.find('.col1 .item').css({'height':(currW/ratio)/2});parent.find('.col2').css({'width':currW*(col2/maxW),'height':(currW/ratio)});parent.find('.col3').css({'width':currW*(col3/maxW)});parent.find('.col3 .item').css({'height':(currW/ratio)/3});parent.find('.col4').css({'width':currW*(col4/maxW)});parent.find('.col4 .item').eq(0).css({'height':(currW/ratio)*2/3});parent.find('.col4 .item').eq(1).css({'height':(currW/ratio)/3});if(!Modernizr.mq("only screen and (max-width: 1024px)")){parent.find(".col4").find(".item.ls").appendTo(parent.find(".col3"));parent.find('.col7-img').attr("src",parent.find('.col7-img').attr("data-size"));}else{parent.find(".col4").find(".item.ls").appendTo(parent.find(".col3"));parent.find('.col7-img').attr("src",parent.find('.col7-img').attr("data-size2"));}
$('.team-details .four.columns').eq(0).css({'margin-left':currW*(col1/maxW)+20})
$('.team-details .row').eq(0).css({'margin-left':currW*(col1/maxW)+20})}
var ww=$(window).width();if($('.footerNavColumn[data-mobileState]').length>0){if(ww<=768){$('.footerNavColumn[data-mobileState="0"]').each(function(){$(this).hide();});}else{$('.footerNavColumn[data-mobileState]').each(function(){$(this).show();});}}}
var resetter;$(document).ready(function(){$('nav .innerColumn li a').on('click',function(e){if(Modernizr.touch&&menuOpen===true&&$('#subnav').is(':animated')){e.preventDefault();}});$(".our-work > a").click(function(event){});$('body').on('click','.popupInit',function(event){var popuptype=$(this).attr('data-type');var parameters=$(this).attr('data-params');clickHandler(popuptype,parameters,$(this),event);});$(window).load(function(){stickyNav();resizeElements();}).resize(function(){resizeElements();}).scroll(function(){stickyNav();});$('.videoFancyBox').fancybox({openEffect:'none',closeEffect:'none',autoSize:true,type:'iframe',iframe:{preload:false}});var sub_height=0;$("header ul li").each(function(){var $this=$(this);if($this.find(".dropdown").length>0&&!$this.hasClass('contact')){sub_height=Math.max($this.find(".dropdown").height()+20+$this.find(".dropdown").find("li").length*3,sub_height);}});window.sub_height=sub_height;$(".media #main, .awards #main, .projects #main, .team #main, .team-details #main").css("margin-top",sub_height+40);$(".ie7 .media #main, .ie7 .awards #main, .ie7 .projects #main, .ie7 .team #main, .ie7 .team-details #main").css("padding-top",sub_height+40);var fullScreenChecker=0;$('.fancybox').fancybox({openEffect:'none',padding:0,helpers:{title:null},beforeLoad:function(){console.log('checkpoint load');this.title=$(this.element).attr('data-desc');if($(".fullscreened").length>0){this.href=$("a[href='"+this.href+"']").attr("data-fullscreenimage");}},afterLoad:function(data){console.log('checkpoint aftershow');var $this=this;var current_image=data.href;if($(".fullscreened").length==0){setTimeout(function(){var $img=$(".container a[href='"+current_image+"']");var $prev=(typeof $img.parent().prev().find("a").attr("href")=="undefined")?$("<img class='prev-slide-image slide-nav' src='"+$img.parent().parent().find(".item").last().find("a").attr("href")+"' alt='Previous Image' />"):$("<img class='prev-slide-image slide-nav' src='"+$img.parent().prev().find("a").attr("href")+"' alt='Previous Image' />");var $next=(typeof $img.parent().next().find("a").attr("href")=="undefined")?$("<img class='next-slide-image slide-nav' src='"+$img.parent().parent().find(".item").first().find("a").attr("href")+"' alt='Next Image' />"):$("<img class='next-slide-image slide-nav' src='"+$img.parent().next().find("a").attr("href")+"' alt='Next Image' />");var $current=$(".fancybox-inner");var ww=$(window).width();var left=(ww-$current.width())/2;var $prevContainer=$("<div class='previous-slide'><div class='overlay-bg'></div></div>").append($prev);var $nextContainer=$("<div class='next-slide'><div class='overlay-bg'></div></div>").append($next);var offsets=$current.find(".fancybox-image").offset();$prevContainer.css({"height":$current.height()-1,"right":(ww-offsets.left)});$nextContainer.css({"height":$current.height()-1,"left":(ww-offsets.left)});$(".fancybox-outer").prepend($prevContainer);$(".fancybox-outer").append($nextContainer);},500);}else{$(".previous-slide, .next-slide").remove();}
$('<div class="fancybox-fullScreen"></div>').appendTo(this.inner).click(function(){fullScreenChecker=1;$(".previous-slide, .next-slide").remove();$('.fancybox-overlay').css({background:'black'}).addClass('fullscreened');$('.fancybox-fullScreen').remove();$(".fancybox-image").attr("src",$("a[href='"+$this.href+"']").attr("data-fullscreenimage"));});},beforeChange:function(data){console.log('checkpoint beforechange');if(fullScreenChecker==1){$('.fancybox-fullScreen').remove();}},afterClose:function(){fullScreenChecker=0;},beforeShow:function(){},openEffect:'elastic',autoDimensions:false,autoSize:false});if($('.background').length>0){$('.background').superslides({play:4000,animation:'fade',animation_speed:2000,pagination:false});}
$('.item').hover(function(){itemHover($(this));},function(){itemUnHover($(this));});ï»¿
if($('nav').length>0){$('nav, #subnav').attr('data-hover',false);$('nav li').hover(function(e){$('nav').attr('data-hover',true);},function(e){$('nav').attr('data-hover',false);});$('#subnav').hover(function(e){$('#subnav').attr('data-hover',true);},function(e){$('#subnav').attr('data-hover',false);});var switchMenu;$('nav li').hover(function(e){var that=$(this);switchMenu=setTimeout(function(){updateMenuContents(that);},50);$('nav li').removeClass('selected');$(this).addClass('selected');},function(e){clearTimeout(switchMenu);clearTimeout(resetter);var menuStatus=false;var el=e.target?e.target:e.toElement;var obj=$(el);if(el!=null&&(obj.is('#subnav')||obj.is('nav')||obj.is('li')||obj.is('header'))){if(obj.is('li')){$(this).removeClass('selected');}
if(obj.parents('#subnav')){}
menuStatus=true;}else{menuStatus=showMenu();}
if(menuStatus==false){$('nav li').removeClass('selected');clearTimeout(resetter);resetter=setTimeout(function(){if($("nav li.selected").length==0){$('#subnav').html('').animate({height:0},500);menuOpen=false;clearTimeout(switchMenu);}},1);}else{}});$('#subnav').hover(function(e){var cla=[];var ulClasses=$(this).find('ul').attr('class');if(typeof(ulClasses)!='undefined'&&ulClasses.length>0){cla=ulClasses.split(' ');}
$('nav li').each(function(i){if(cla.length>0&&$(this).hasClass(cla[0])){$(this).addClass('selected');}});},function(e){var menuStatus=false;var el=e.target?e.target:e.toElement;var obj=$(el);if(el!=null&&(obj.is('nav')||$(e.toElement).is('nav li')||obj.is('li.selected')||obj.is('header'))){menuStatus=true;}else{menuStatus=showMenu();}
if(menuStatus==false){$('#subnav').html('').animate({height:0},500);$('nav li.selected').removeClass('selected');menuOpen=false;clearTimeout(switchMenu);}else{}});function updateMenuContents(obj){var ww=$(window).width();var leftAdj=-(ww-960)/2;var dropdownStr='';var menuStatus=showMenu();var classStr=obj.attr('class');if(obj.find('ul.dropdown').length>0){dropdownStr=obj.find('ul.dropdown').html();}
$('#subnav').html('<div class="innerColumn"><ul class="'+classStr+'">'+dropdownStr+'</ul></div>');if(menuStatus==true&&obj.find('ul.dropdown').length>0){if(menuOpen===false){$('#subnav').stop(true,true).animate({height:sub_height},1500);menuOpen=true;}}else{$('#subnav').animate({height:0},500);menuOpen=false;clearTimeout(switchMenu);}}
function showMenu(){var showMenuStatus=false;var navStatus=$('nav').attr('data-hover');var subNavStatus=$('#subnav').attr('data-hover');if((typeof($('nav').attr('data-hover'))!='undefined'&&navStatus=='true')||(typeof($('#subnav').attr('data-hover'))!='undefined'&&subNavStatus=='true')){showMenuStatus=true;}
return showMenuStatus;}
function revertToActiveMenu(){var activeMenuStr='';var activeMenu=$('nav li.active').find('ul.dropdown');if(activeMenu.length>0){activeMenuStr=activeMenu.html();}
return activeMenuStr;}}
function stickyNav(){var stickyNavTop=20;var scrollTop=$(window).scrollTop();if(scrollTop>stickyNavTop){$('header').addClass('sticky');}else{$('header').removeClass('sticky');}}
$(window).load(function(){}).scroll(function(){if($(this).scrollTop()>100){$('.scrollup').fadeIn();}else{$('.scrollup').fadeOut();}});$('#mediaFileOptions').on('click','#openMediaFileBtn',openMediaFileBtnClickHandler);$('#mediaFileOptions').on('click','#downloadMediaFileBtn',downloadMediaFileBtnClickHandler);});function clickHandler(type,params,obj,event){if(typeof(params)=='undefined'){params=null;}
if(typeof(obj)=='undefined'){obj=null;}
switch(type){case'updateProfiles':var parent=obj.parents('.servicesList');parent.find('li').removeClass('active');obj.addClass('active');$.each(serviceData,function(i,v){if(v.id==params){$('.serviceDescription .desc').html(v.description);return;}});break;case'callNow':obj.find('.descriptionText').addClass('hidden');obj.find('a.number').removeClass('hidden-indent');obj.removeClass('popupInit');break;case'close':$('body .overlay').remove();$('body .overlaybackground').remove();$(document).unbind("keypress.key27");break;case'emailPop':$(document).bind('keydown',function(e){if(e.which=='27'||e.keyCode=='27'){$('body .overlay').remove();$('body .overlaybackground').remove();$(document).unbind("keypress.key27");}});var popH=540;var wH=$(window).height();var scrollpos=$(window).scrollTop();var marginAdjustTop=scrollpos+((wH-popH)/2);marginAdjustTop=' style="margin-top:'+marginAdjustTop+'px;"';var overlayContents='';overlayContents+='<div class="popupContents"><form class="formCheck" id="emailWishlistForm" method="post"><h4>Email Your Wishlist</h4><fieldset><table id="wishlistemail" style="margin:10px 0; width:480px;"><tr><td colspan="2"></td></tr><tr><td width="150" style="vertical-align:top;"><label for="cname" style="margin-bottom:15px;">From (name)*</label></td><td><input id="cname" name="fromName" size="25"  value="" minlength="2" type="text" class="required" placeholder="From Name)" /></td></tr><tr><td style="vertical-align:top;"><label for="cemail" style="margin-bottom:10px;">From (email)*</label></td><td><input id="cemail" name="fromEmail" value="" size="25" type="email" class="required" placeholder="From (Email)" /></td></tr><tr><td colspan="2"><hr /></td></tr><tr><td width="150" style="vertical-align:top;"><label for="cname2" style="margin-bottom:15px;" >To (name)*</label></td><td><input id="cname2" name="toName" size="25" value="" minlength="2" type="text" class="required" placeholder="To (Name)" /></td></tr><tr><td style="vertical-align:top;"><label for="cemail2" style="margin-bottom:15px;">To (email)*</label></td><td><input id="cemail2" name="toEmail" value="" size="25" type="email" class="required" placeholder="To (Email)" /></td></tr><tr><td style="vertical-align:top;"></td><td><br/>Message:<br> <br><textarea id="ccomment" name="comment" cols="22"></textarea></td></tr></table><p><input id="emailWishlistFromSubmitBtn" class="submit right formCheckSubmit" type="submit" value="SUBMIT" name="emailWishlist" /></p></fieldset></form></div>';var overlay='<div class="overlaybackground"></div><div class="overlay"><div class="popupContainer" '+marginAdjustTop+'><div class="popupInit close" data-type="close">CLOSE</div>'+overlayContents+'</div></div>';$('body').prepend(overlay);break;case'updateSelect':if(typeof(obj.attr('data-bind'))!='undefined'&&obj.attr('data-bind')!='null'){var bind=obj.attr('data-bind');var relatedObj=$('select[data-bind="'+bind+'"]');relatedObj.find('option').removeAttr('selected');relatedObj.find('option[value="'+params+'"]').attr('selected',true);obj.parents('ul.selectField').find('li span.selectedValue').text(obj.text());if(bind=='selectStoneFilters'){placeOfOriginSelectHandler(relatedObj.val());}}
break;case'scrollToTop':if(!params){params=0;}
$('html, body').animate({scrollTop:params},400);break;case'tabSetup':if(params!=null){obj.parents('ul').find('li').removeClass('active');obj.addClass('active')
$('.instructionTabs .contents').addClass('hidden');$('.instructionTabs .contents[data-params="'+params+'"]').removeClass('hidden');}
break;case'tabSetup2':if(params!=null){obj.parents('ul').find('li').removeClass('active');obj.addClass('active')
$('.tabContent').addClass('hidden');$('.tabContent[data-params="'+params+'"]').removeClass('hidden');}
break;case'toggle':if(params=='visible'){$('#whatsNew').animate({'height':'22px'},500);$('#whatsNew .contents, #whatsNew .img-container').animate({'height':'0px'},500);obj.attr('data-params','hidden');}else{$('#whatsNew').animate({'height':'190px'},500);$('#whatsNew .contents, #whatsNew .img-container').animate({'height':'168px'},500);obj.attr('data-params','visible');}
break;case'toggleGalleryViews':var parents=obj.parents('ul#galleryControls');parents.find('li').removeClass('active');obj.addClass('active');$(document).unbind('click.fb-start');if(params=='slider'&&$('#gallery.slider').length==0&&$('#pagesGallery').length==0){location.reload();}else if(params=='thumb'&&$('#gallery.thumb').length==0&&$('#pagesGallery').length==0){$('.fancybox').fancybox({openEffect:'none',closeEffect:'none'});$('#gallery.slider').cycle('destroy');$('#gallery').removeClass().addClass('thumb');}else if(params=='slider'&&$('#pagesGallery.slider').length==0&&$('#gallery').length==0){location.reload();}else if(params=='thumb'&&$('#pagesGallery.thumb').length==0&&$('#gallery').length==0){$('.pagesGalleryCaption').hide();$('#pagesGallery.slider').cycle('destroy');$('#pagesGallery').removeClass().addClass('thumb');$('.fancybox').fancybox({openEffect:'none',closeEffect:'none'});}else{return false;}
break;case'mediaFile':event.preventDefault();$('body').off('click',mediaFileOptionsOutsideClickHandler);$('body').on('click',mediaFileOptionsOutsideClickHandler);var mediaFileOptionsStr=''+'<div id="openMediaFileBtn" data-mediaLink="'+$(obj).attr('href')+'">Open</div>'+'<div id="downloadMediaFileBtn" data-fileId="'+$(obj).attr('data-fileId')+'">Download</div>'+'';$('#mediaFileOptions').html(mediaFileOptionsStr).addClass('opened');break;default:break;}}
function mediaFileOptionsOutsideClickHandler(e){if(!$(e.target).is('#mediaFileOptions *, .mediaPdfs *')){$('#mediaFileOptions').html('');$('body').off('click',mediaFileOptionsOutsideClickHandler);$('#mediaFileOptions').removeClass('opened');}}
function openMediaFileBtnClickHandler(e){window.location.href=$(this).attr('data-mediaLink');}
function downloadMediaFileBtnClickHandler(e){window.location.href=siteUrl+'media/download/'+$(this).attr('data-fileId');}
function placeOfOriginSelectHandler(placeOfOriginId){if(typeof(placeOfOriginId)=='undefined'||placeOfOriginId=='null'){placeOfOriginId=$(this).val();}
var redirectLink=siteUrl+'stones';if(placeOfOriginId>0){var filters={'filters':{'placeOfOriginId':placeOfOriginId}};var filtersStr=$.param(filters);redirectLink+='?'+filtersStr;}
window.location.href=redirectLink;}
function itemHover($el){var overlay=$el.find('.overlay');var desc=overlay.find('.desc');var descOffset=desc.height();var overflowHeight=$el.height();var finalHeight=overflowHeight-descOffset;desc.css({'margin-top':overflowHeight});overlay.css({'visibility':'visible'});desc.stop().animate({'margin-top':finalHeight},1000);}
function itemUnHover($el){if(!isMobile){var overlay=$el.find('.overlay');var desc=overlay.find('.desc');var descOffset=desc.height();var overflowHeight=$el.height();desc.stop().animate({'margin-top':overflowHeight},500);overlay.css({'visibility':'visible'});}}
var click_count=0,click_link="";if(Modernizr.touch){jQuery(document).ready(function($){setTimeout(function(){$(".item").each(function(index,el){itemHover($(el));});},500);});}else{}
var slider;var isTouchable=Modernizr.touch;jQuery(document).ready(function($){$(".fancybox2").click(function(event){event.preventDefault();var slide_width=(!isMobile)?$(window).width()/2:$(window).width();var fullscreen_slider="<div class='fullscreen-slider slides'><div class='slides-container'>";var slides="<ul class='bxslider'>",slides_generated=false;var $items=$(".fancybox2"),current_slide=-1,$this=$(this),i=0;$items.each(function(index,el){var $t=$(this);if($t.attr("href")==$this.attr("href"))
current_slide=i;slides+="<li><img data-index='"+i+"' src='"+$t.attr("href")+"' /> <span class='maximize'></span></li>";var full_src=(typeof $t.attr("data-fullscreenimage")=='undefined')?$t.attr("href"):$t.attr("data-fullscreenimage");fullscreen_slider+="<li><img src='"+full_src+"' /></li>";i++;});fullscreen_slider+="</div>"+"<a href=\"#\" class=\"close-fullscreen\">Close</a> "+"<nav class=\"slides-navigation\">"+"<a href=\"#\" class=\"next\">Next</a> "+"<a href=\"#\" class=\"prev\">Previous</a> "+"</nav></div>";slides+="</ul>";slides_generated=true;if(!isTouchable){var new_slider="<div class='slideshow'>"+slides+"</div>";$("body").append(new_slider);slider=$('.bxslider').bxSlider({slideWidth:slide_width,slideMargin:10,onSliderLoad:function(currentIndex){if(!isTouchable){$(".bxslider").find("li").addClass('fade-out');$(".bxslider").find("li").eq(2).removeClass('fade-out');}
$(".bx-wrapper").prepend("<span class='close-normalscreen'>Close</span>");var position_top=$(window).height()-$(".bx-wrapper").height();$(".bx-wrapper").css('top',position_top/2);setTimeout(function(){goToSlide(current_slide-1);var slideHeight=$(".bx-viewport").height();$(".bxslider li").each(function(index,el){$(this).height(slideHeight);});},100);$(".bxslider").append($(".bxslider").find("li").eq(2).clone());},onSlideBefore:function($slideElement,oldIndex,newIndex){if(!isMobile){$(".bxslider").find("li").addClass('fade-out');$slideElement.next().removeClass('fade-out');}}});}else{$("body").append(fullscreen_slider);$fullscreen_slider=$(".fullscreen-slider");$fullscreen_slider.superslides();setTimeout(function(){if($fullscreen_slider.superslides('current')!=$this.find("img").attr("data-index"))
$fullscreen_slider.superslides("animate",$this.find("img").attr("data-index"));},1000);}
$("body").on("click",".bxslider li",function(e){e.preventDefault();var $this=$(this);$("body").append(fullscreen_slider);$fullscreen_slider=$(".fullscreen-slider");$fullscreen_slider.superslides();setTimeout(function(){if($fullscreen_slider.superslides('current')!=$this.find("img").attr("data-index"))
$fullscreen_slider.superslides("animate",$this.find("img").attr("data-index"));},1000);});$("body").on("click",".close-fullscreen",function(e){e.preventDefault();$fullscreen_slider.superslides("destroy");$fullscreen_slider.remove();});$("body").on("click",".close-normalscreen",function(e){e.preventDefault();slider.destroySlider();$(".slideshow").remove();});});});function goToSlide(index)
{slider.goToSlide(index);}
$(window).load(function(){if($(".ie7").length==0&&$(".ie8").length==0)
{$('.item .inner, .col1 .item, .col2 .item, .col3 .item, .col4 .item').BlackAndWhite({hoverEffect:true,webworkerPath:siteUrl+'js/',invertHoverEffect:false,intensity:1,speed:{fadeIn:200,fadeOut:800},onImageReady:function(img){}});}});function resetter()
{$("canvas").each(function(index,el){var $t=$(this),$p=$t.parent();$t.width($p.find("img").width());$t.height($p.find("img").height());});}
setTimeout(resetter,500);$("body").on("click",".BWfade",function(){var $t=$(this);console.log($t.next("a").attr("href"));});